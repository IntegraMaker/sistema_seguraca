<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Validade</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>
<body>
    <header>
        {% include "navBar.html"%}
    </header>

    <main class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Gestão de Validade de Acesso</h2>
        </div>

        {% if msg %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{ msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}

        {% if erro %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            {{ erro }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}

        <form action="/cadastro/renovacao" method="POST">
            <div class="mb-3 d-flex gap-2">
                <button type="submit" class="btn btn-warning fw-bold">
                    <i class="bi bi-clock-history"></i> Renovar Selecionados (+1 Ano)
                </button>
            </div>

            <div class="card shadow-sm">
                <div class="card-body p-0">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col" class="text-center" style="width: 50px;">
                                    <input class="form-check-input" type="checkbox" id="selectAll">
                                </th>
                                <th scope="col">Nome</th>
                                <th scope="col">Cargo</th>
                                <th scope="col">Validade Atual</th>
                                <th scope="col" class="text-end">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pessoa in listaPessoas['pessoas'] %}
                            <tr>
                                <td class="text-center">
                                    <input class="form-check-input check-item" type="checkbox" name="cpfs" value="{{ pessoa.cpf }}">
                                </td>
                                <td>{{ pessoa.nome }}</td>
                                <td>{{ pessoa.cargo }}</td>
                                <td>
                                    {% if pessoa.validade_qrcode %}
                                        {{ pessoa.validade_qrcode.strftime('%d/%m/%Y') }}
                                    {% else %}
                                        <span class="badge text-bg-secondary">Sem Validade</span>
                                    {% endif %}
                                </td>
                                <td class="text-end">
                                    <a href="/pessoa/carteira?cpf={{ pessoa.cpf }}" class="btn btn-sm btn-outline-primary">Ver Carteira</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </form>

        <nav aria-label="Navegação de página" class="mt-4">
            <ul class="pagination justify-content-center">
                {% if listaPessoas['paginaAtual'] > 1 %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('cadastro.renovacao_massa', page=listaPessoas['paginaAtual']-1) }}">Anterior</a>
                </li>
                {% endif %}

                <li class="page-item disabled">
                    <span class="page-link">Página {{ listaPessoas['paginaAtual'] }} de {{ listaPessoas['paginas'] }}</span>
                </li>

                {% if listaPessoas['paginaAtual'] < listaPessoas['paginas'] %}
                <li class="page-item">
                     <a class="page-link" href="{{ url_for('cadastro.renovacao_massa', page=listaPessoas['paginaAtual']+1) }}">Próximo</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js" integrity="sha384-7qAoOXltbVP82dhxHAUje59V5r2YsVfBafyUDxEdApLPmcdhBPg1DKg1ERo0BZlK" crossorigin="anonymous"></script>
    
    <script>
        document.getElementById('selectAll').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.check-item');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
    </script>
</body>
</html>